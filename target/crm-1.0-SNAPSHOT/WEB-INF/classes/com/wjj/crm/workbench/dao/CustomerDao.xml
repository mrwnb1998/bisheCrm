<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.wjj.crm.workbench.dao.CustomerDao">
    <select id="getSourceCharts" resultType="Map">
          SELECT department,COUNT(1) AS total
        FROM tbl_customer
        GROUP BY department
    </select>
     <select id="detail" resultType="Customer">
           select
        a.id,a.name,u.name as owner,a.phone,a.label,a.level,a.department,a.dreamSale,a.trueSale,
      a.website,a.createBy,a.createTime,a.editBy,a.editTime,a.description,a.contactSummary,a.nextContactTime,a.address
        from tbl_customer a
        join tbl_user u
        on a.owner=u.id
        where a.id=#{id};
    </select>
     <update id="hand">
        update tbl_customer set
        owner='40f6cdea0bd34aceb77492a1656d9fb3'
        where owner=#{id}
    </update>
     <select id="getCustomerListName" resultType="Customer">
          select id,name,phone,department,dreamSale
          from tbl_customer
          where name like #{aname}
     </select>
     <select id="getTotalByCondition" resultType="int">
          select count(*)
          from tbl_customer a
          join tbl_user u
          on a.owner=u.id
          <where>
               <if test="name!=null and name!=''">
                    a.name like '%' #{name} '%'
               </if>
               <if test="owner!=null and owner!=''">
                    and u.name like '%' #{owner} '%'
               </if>
               <if test="phone!=null and phone!=''">
                    and a.phone like '%' #{phone} '%'
               </if>
               <if test="website!=null and website!=''">
                    and a.website like '%' #{website} '%'
               </if>
          </where>

     </select>
     <select id="getCustomerListByCondition" resultType="Customer">
          select
          a.id,a.name,u.name as owner,a.phone,a.website
          from tbl_customer a
          join tbl_user u
          on a.owner=u.id
          <where>
               <if test="name!=null and name!=''">
                    a.name like '%' #{name} '%'
               </if>
               <if test="owner!=null and owner!=''">
                    and u.name like '%' #{owner} '%'
               </if>
               <if test="phone!=null and phone!=''">
                    and a.phone like '%' #{phone} '%'
               </if>
               <if test="website!=null and website!=''">
                    and a.website like '%' #{website} '%'
               </if>
          </where>
          order by a.createTime desc
          limit #{skipCount},#{pageSize}

     </select>
<select id="getCustomerByName" resultType="Customer">
    select * from tbl_customer where name=#{company}
</select>
<insert id="save">
     insert into tbl_customer(
     id,
     owner,
     name,
     website,
     phone,
     createBy,
     createTime,
     contactSummary,
     nextContactTime,
     description,
     address,
     label,
     level,
     department
     )values (
     #{id},
     #{owner},
     #{name},
     #{website},
     #{phone},
     #{createBy},
     #{createTime},
     #{contactSummary},
     #{nextContactTime},
     #{description},
     #{address},
     #{label},
     #{level},
     #{department}
     )
</insert>
     <select id="getCustomerName" resultType="String">
select name from tbl_customer where name like #{name};

     </select>
</mapper>

































